// Package javadoc and sources
java {
    withJavadocJar()
    withSourcesJar()
}

// Configure JReleaser
jreleaser {

    project {
        name = rootProject.artifactId
        version = rootProject.version
        versionPattern = 'CUSTOM'
        snapshot {
            pattern = '.*-SNAPSHOT'
            label = 'early-access'
            fullChangelog = true
        }
        description = rootProject.description
        longDescription = rootProject.longDescription
        authors = [rootProject.developerName]
        tags = [
            'java',
            'library',
            'jackson',
            'java-library',
            'result',
            'serde-json',
            'serde-support',
            'jackson-databind'
        ]
        maintainers = [rootProject.developerName]
        license = rootProject.licenseId
        inceptionYear = rootProject.inceptionYear
        copyright = rootProject.copyright
        vendor = rootProject.organizationName
        links {
            homepage = rootProject.repository
            documentation = rootProject.homepage
            license = rootProject.licenseUrl
            bugTracker = rootProject.issuesUrl
            vcsBrowser = rootProject.repository
            donation = rootProject.sponsorUrl
        }
        languages {
            java {
                groupId = rootProject.group
                artifactId = rootProject.artifactId
                version = '8'
            }
        }
        icon {
            url = rootProject.iconUrl
            primary = true
            width = 64
            height = 64
        }
    }

    release {
        github {
            enabled = true
            repoOwner = rootProject.organizationId
            name = rootProject.artifactId
            username = rootProject.developerId
            tagName = rootProject.version
            previousTagName = rootProject.previousVersion
        }
    }

    signing {
        active = 'RELEASE'
        verify = false
        mode = 'MEMORY'
    }

    distributions {
        library {
            distributionType = 'JAVA_BINARY'
            tags = [
                'java',
                'library',
                'jackson',
                'java-library',
                'result',
                'serde-json',
                'serde-support',
                'jackson-databind'
            ]
            artifact {
                path = "build/libs/result-jackson-{{projectVersion}}.jar"
            }
            artifact {
                path = "build/libs/result-jackson-{{projectVersion}}-sources.jar"
                platform.set("java-sources")
            }
            artifact {
                path = "build/libs/result-jackson-{{projectVersion}}-javadoc.jar"
                platform.set("java-docs")
            }
            java {
                groupId = rootProject.group
                artifactId = rootProject.artifactId
                version = '8'
            }
        }
    }

    deploy {
        maven {
            mavenCentral {
                'release-deploy' {
                    active = 'RELEASE'
                    url = 'https://central.sonatype.com/api/v1/publisher'
                    stagingRepository('target/staging-deploy')
                }
            }
            nexus2 {
                'snapshot-deploy' {
                    active = 'SNAPSHOT'
                    url = 'https://oss.sonatype.org/service/local'
                    snapshotUrl = 'https://central.sonatype.com/repository/maven-snapshots'
                    applyMavenCentralRules = true
                    snapshotSupported = true
                    closeRepository = true
                    releaseRepository = true
                    stagingRepository('target/staging-deploy')
                }
            }
        }
    }
}
